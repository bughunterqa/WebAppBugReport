@model WebAppBugReport.Data.Models.BugList

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}








@foreach (var status in Model.Statuses)
{
    <div class="column-header-test ">
        
        
        <div class="card column back-column " data-id="@status.Id">
            <div style="padding-bottom:20px; font-size:16px">@status.Name</div>
            

            @foreach (var item in Model.Bugs)
            {
                if (item.StatusId == @status.Id)
                {

                    <div class="portlet card-body text-left  " data-id="@item.Id">
                        <div class="portlet-header ard-title ">
                            <div>
                                ID# @item.Id
                                @if (item.Priority.Name == "Low")
                                {
                                    <i class="bi bi-bug " style="cursor:pointer; float:right; color:green " data-toggle="tooltip" data-placement="left" title="Priority: @item.Priority.Name"></i>
                                }
                                else if (item.Priority.Name == "Medium")
                                {
                                    <i class="bi bi-bug " style="cursor:pointer; float:right; color:orange " data-toggle="tooltip" data-placement="left" title="Priority: @item.Priority.Name"></i>
                                }
                                else
                                {
                                    <i class="bi bi-bug " style="cursor:pointer; float:right; color:red " data-toggle="tooltip" data-placement="left" title="Priority: @item.Priority.Name"></i>
                                }


                            </div>


                        </div>
                        @*<img src="@item.BugImg" class="card-img-top" alt="..." style="width:145px">*@
                        <div class="portlet-content  card-text">@item.Summary</div>


                        <button type="button" class="btn btn-primary form-control open-details-modal" data-toggle="modal" style="background:#336B87" data-whatever="@item.Id">Details  </button>




                        <div class="modal fade details-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-xl" role="document" style="min-width:1300px; min-height:2600px">
                                <div class="modal-content">
                                    @foreach (var bug in Model.Bugs.Where(p => p.Id == @item.Id))
                                    {
                                        <div class="modal-header text-left" style="background-color:#283655">
                                            <h5 class="modal-title" id="exampleModalLabel" style="color:white">Bug # @bug.Id   <br />  Priority: @bug.Priority.Name</h5>
                                            @*<button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>*@
                                        </div>
                                        <div class="modal-body" style="background-color:#D0E1F9">
                                            <div class="row">
                                                <div class="col-md-12  ">
                                                    <div class="control-label">Summary</div>
                                                    <div class="form-control" style="max-width: 100% " placeholder="What? Where? When?">@bug.Summary</div>
                                                </div>


                                                @if (@bug.Description != null)
                                                {
                                                    <div class="col-md-6 row-padding">
                                                        <div class="control-label">Description</div>
                                                        <div class="form-control" style="max-width: 100%; height: 100% ">@bug.Description</div>
                                                    </div>
                                                }

                                                @if (@bug.StepToReproduce != null)
                                                {
                                                    <div class="col-md-6 row-padding">
                                                        <div class="control-label">Step to Reproduce</div>
                                                        <div class="form-control" style="max-width:98%; height:100%">@bug.StepToReproduce</div>
                                                    </div>
                                                }


                                                @if (@bug.ActualResult != null)
                                                {
                                                    <div class="col-md-6 row-padding">
                                                        <div class="control-label">Actual Result</div>
                                                        <div class="form-control" style="max-width:100%; height:100%">@bug.ActualResult</div>
                                                    </div>
                                                }

                                                @if (@bug.ExpectedResult != null)
                                                {
                                                    <div class="col-md-6 row-padding">
                                                        <div class="control-label">Expected Result</div>
                                                        <div class="form-control" style="max-width:98%; height:100%">@bug.ExpectedResult</div>
                                                    </div>
                                                }

                                                @if (@bug.Comment != null)
                                                {
                                                    <div class="col-md-9 row-padding ">
                                                        <div class="control-label">Comment</div>
                                                        <div class="form-control" style="max-width:100%; height:100%">@bug.Comment</div>
                                                    </div>
                                                }

                                                @if (@bug.Link != null)
                                                {
                                                    <div class="col-md-3 row-padding">
                                                        <div class="control-label">Link</div>
                                                        <a href="@item.Link" class="form-control cut-text" style="max-width:96%; ">@item.Link</a>
                                                    </div>
                                                }




                                                <div class="col-md-12 row-padding text-center ">
                                                    <img id="myImg" src="@item.BugImg" alt="@item.Summary" style="width:100%;max-width:300px">

                                                </div>

                                            </div>













@*
                                            <dl class="dl-horizontal text-left">

                                                

                                              

                                                <dt>Comment</dt>
                                                <dd>@bug.Comment</dd>

                                                <dt>Link</dt>
                                                <dd>@bug.Link</dd>

                                            </dl>

*@

                                            @*<img id="myImg" src="@item.BugImg" alt="@item.Summary" style="width:100%;max-width:300px">*@


                                            <div id="myModal" class="modal-img ">
                                                <span class="close-img">×</span>
                                                <img class="modal-content-img" id="img01">
                                                <div id="caption"></div>
                                            </div>



                                        </div>
                                    }

                                    <div class="modal-footer" style="background-color:#283655">
                                        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>

                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>


                }
            }

        </div>
    </div>
}





@section scripts {
    <script src="~/Scripts/app/JavaScript.js"></script>
    <script src="~/Scripts/app/ImageModal.js">
    </script>
    <script>
        $(function () {
            $(".column").sortable({
                connectWith: ".column",
                handle: ".portlet-header",
                cancel: ".portlet-toggle",
                placeholder: "portlet-placeholder ui-corner-all",
                receive: onTicketChange

            });

            $(".portlet")
                .addClass("ui-widget ui-widget-content ui-helper-clearfix ui-corner-all")
                .find(".portlet-header")
                .addClass("ui-widget-header ui-corner-all");
        });

        function onTicketChange(event, ui) {
            let columnId = $(event.target).closest('.column').data('id');
            let bugId = ui.item.data("id");
            $.ajax({
                url: '/Bug/Edit',
                type: 'POST',
                data: { id: bugId, statusId: columnId }
            })
        }

    </script>


}







